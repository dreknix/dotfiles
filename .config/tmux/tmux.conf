# prevent tmux from starting login shells
set -g default-command /bin/zsh

# set ctrl-a as second prefix
set -g prefix2 C-a
bind C-a send-prefix -2

# allow pane switching with mouse
setw -g mouse on

# enable configurataion reload on C-a r
bind-key r source-file ~/.config/tmux/tmux.conf \; display-message "tmux.conf reloaded"

# prevent strange ESC behavior with tmux & vi
set-option -sg escape-time 10

# enable 256-colors
# set -g default-terminal 'xterm-256color'
set -g default-terminal 'screen-256color'

# Use RGB color support
# tmux 3.2 and later (in lab there is tmux 2.7)
#set -ag terminal-overrides ",xterm-256color*:Tc"
set -ag terminal-overrides ",xterm-256color*:RGB"

# for neovim
set-option -g focus-events on

# loud or quiet?
set -g visual-bell off
set -g visual-silence off
set -g bell-action none
set -g visual-activity off
set-window-option -g monitor-activity on

# start window index at 1
set -g base-index 1

# start pane index at 1
set -g pane-base-index 1

# renumber when window is closed
set-option -g renumber-windows on

## switch between panes with ALT + arrow keys
# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n 'M-Left'  if-shell "$is_vim" 'send-keys M-Left'  'select-pane -L'
bind-key -n 'M-Down'  if-shell "$is_vim" 'send-keys M-Down'  'select-pane -D'
bind-key -n 'M-Up'    if-shell "$is_vim" 'send-keys M-Up'    'select-pane -U'
bind-key -n 'M-Right' if-shell "$is_vim" 'send-keys M-Right' 'select-pane -R'

bind-key -T copy-mode-vi 'M-Left'  select-pane -L
bind-key -T copy-mode-vi 'M-Down'  select-pane -D
bind-key -T copy-mode-vi 'M-Up'    select-pane -U
bind-key -T copy-mode-vi 'M-Right' select-pane -R

bind-key -n 'S-M-Left'  previous-window
bind-key -n 'S-M-Right' next-window

# don't rename windows automatically
set-option -g allow-rename off

# place status top / bottom
set-option -g status-position top

# update status bar every 5 seconds
set -g status-interval 5

# scrolling
# PageUp/Down - is working in vi
# Shift-PageUp/Down - is working in tmux
# Ctrl-PageUp/Down - should working in terminal (testing)
bind -n S-Pageup copy-mode -u
bind -n S-Pagedown send-keys Pagedown

# split window relative to current path
bind h split-window -h -c "#{pane_current_path}"
bind v split-window -v -c "#{pane_current_path}"

# using vi bindings in copy mode
setw -g mode-keys vi

# start copy mode with Alt+ö
bind-key -n 'M-ö' copy-mode

# paste content with Prefix + P (shift P)
bind P paste-buffer

# Leader-
bind H display-popup -T " htop " -E "tmux new-session -A -s htop 'tmux set status off; htop'"

###
### session manager tmuxp
### https://github.com/tmux-python/tmuxp
### configurations see: ~/.config/tmuxp
###
# tmux load dreknix-wiki

###
### tmux - plugins
### git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm
### Install plugins - Prefix + I (shift i)
### Update plugins  - Prefix + U (shift u)
###

### Plugin: 'tmux-plugins/tmux-yank'
#set -g @override_copy_command 'xsel --primary --input'
set -g @override_copy_command 'xclip -selection primary -rmlastnl'
set -g @yank_selection 'primary' # or 'secondary' or 'clipboard'
set -g @yank_selection_mouse 'primary' # or 'secondary' or 'clipboard'

### Plugin: 'catppuccin/tmux'
set -g @catppuccin_flavor 'mocha' # latte/frappe/macchiato/mocha
set -g @catppuccin_window_left_separator '█'
set -g @catppuccin_window_middle_separator ' '
set -g @catppuccin_window_right_separator ''
set -g @catppuccin_window_status 'no' # no/icon/text
set -g @catppuccin_window_default_fill 'number'
set -g @catppuccin_window_default_text '#W'
set -g @catppuccin_window_current_fill 'number'
set -g @catppuccin_window_current_text '#W'
set -g @catppuccin_window_number_position 'right'
set -g @catppuccin_date_time_text "%d.%m. %H:%M"

# catppuccin modules: directory user host session date_time
set -g @catppuccin_status_modules_left 'session'
set -g @catppuccin_status_modules_right 'primary_ip date_time'
set -g @catppuccin_status_connect_separator "yes"
set -g @catppuccin_status_background "#{thm_gray}"
set -g @catppuccin_window_current_background "#{thm_black4}"

### Plugin: 'joshmedeski/tmux-nerd-font-window-name'
# currently no config

### Plugin: 'alexwforsythe/tmux-which-key'
# config in ~/.config/tmux/tmux-nerd-font-window-name.yml

### Plugin: 'dreknix/tmux-primary-ip'
set -g @primary_ip_with_icon 'no'

### Plugin: 'omerxx/tmux-sessionx'
set -g @sessionx-bind 'o'
set -g @sessionx-x-path '~/dreknix'            # in sessionx - ctrl-x
set -g @sessionx-filter-current 'false'
set -g @sessionx-window-mode 'off'
set -g @sessionx-tree-mode 'off'
set -g @sessionx-preview-location 'right'
set -g @sessionx-preview-ratio '55%'
set -g @sessionx-bind-kill-session 'alt-x'
set -g @sessionx-zoxide-mode 'on'              # in sessionx - ctrl-f

### list of plugins
set -g @plugin 'tmux-plugins/tpm'
#
# basic plugins
set -g @plugin 'tmux-plugins/tmux-yank'
#
# theme / style
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name'
set -g @plugin 'alexwforsythe/tmux-which-key'  # prefix + space
set -g @plugin 'dreknix/tmux-primary-ip'
#
# tooling
set -g @plugin 'omerxx/tmux-sessionx'          # prefix + o

# initialize tmux plugin manager (keep this line at the very bottom of tmux.conf)
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.config/tmux/plugins'
run '~/.config/tmux/plugins/tpm/tpm'
